services:
  navigation:
    build:
      context: ./navigation
      dockerfile: Dockerfile
    image: nycusystemlab/navigation:latest
    container_name: navigation
    network_mode: "host"
    privileged: true
    runtime: nvidia
    environment:
      - DISPLAY=${DISPLAY}
      - NVIDIA_VISIBLE_DEVICES=all
      - NVIDIA_DRIVER_CAPABILITIES=all
      - QT_X11_NO_MITSHM=1
    volumes:
      # 系統層級掛載
      - /tmp/.X11-unix:/tmp/.X11-unix:rw
      - /dev:/dev
      - /var/run/dbus:/var/run/dbus
      - /run/udev:/run/udev
      # - /sys/class/gpio:/sys/class/gpio  # JP6 已無此路徑
      - /sys/devices:/sys/devices
      - /proc/device-tree:/proc/device-tree
      - /etc/localtime:/etc/localtime:ro
      
      # 專案程式碼掛載 (請確保 Host 路徑正確)
      # 左邊是 Host 路徑，右邊是 Container 路徑
      - ./navigation/src/hdl_ws/src:/root/hdl_ws/src
      - ./navigation/src/lidar_ws/src:/root/lidar_ws/src
      
      # *** 新增 Realsense 工作空間掛載 ***
      # 如果您的原始碼在 ~/disk/realsense_ws/src，請修改左邊路徑
      # 範例： - /home/User/disk/realsense_ws/src:/root/realsense_ws/src
      - ./navigation/src/realsense_ws/src:/root/realsense_ws/src
      - ./navigation/src/keyboard_control_ws/src:/root/keyboard_control_ws/src

    entrypoint: ["/root/entrypoint.sh"]
    tty: true
    stdin_open: true
    restart: unless-stopped